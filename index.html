<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KristoShop</title>

<!-- Tailwind CSS -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">

<!-- Lucide Icons -->
<script src="https://cdn.jsdelivr.net/npm/lucide/dist/lucide.min.js"></script>

<!-- Stripe.js -->
<script src="https://js.stripe.com/v3/"></script>

<!-- Vercel Env Variables -->
<meta name="stripe-publishable-key" content="%STRIPE_PUBLISHABLE_KEY%">
<meta name="stripe-secret-key" content="%STRIPE_SECRET_KEY%">
</head>
<body class="bg-[#050505] text-white font-sans">
<div id="app"></div>

<script type="module">
const STRIPE_PUBLISHABLE_KEY = document.querySelector('meta[name="stripe-publishable-key"]').content;
const STRIPE_SECRET_KEY = document.querySelector('meta[name="stripe-secret-key"]').content;

let DATA = null;
let cart = [];
let currentPage = 'home';
let selectedProduct = null;
let showCart = false;

// Helper for icons
function getIcon(name){ return lucide.createIcon(name, { class: 'w-5 h-5' }).outerHTML; }

// Load JSON
fetch('data.json').then(r=>r.json()).then(json=>{ DATA=json; renderApp(); }).catch(e=>console.error(e));

function navigateTo(page, product=null){ currentPage=page; selectedProduct=product; renderApp(); window.scrollTo(0,0);}
function addToCart(item){ item.cartId=Math.random().toString(36).substr(2,9); cart.push(item); renderApp();}
function removeFromCart(id){ cart=cart.filter(i=>i.cartId!==id); renderApp();}
function totalPrice(){ return cart.reduce((acc,i)=>acc+(i.price||0),0);}
function handleCheckout(){ 
  if(!STRIPE_PUBLISHABLE_KEY){ alert("Stripe key missing!"); return;}
  const stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
  alert("Stripe checkout would happen now. Total: $"+totalPrice());
}

function renderApp(){
  if(!DATA) return;
  document.getElementById('app').innerHTML=`
  <nav class="fixed top-0 w-full z-50 px-6 py-4 flex justify-between items-center border-b border-orange-500/10 backdrop-blur-3xl bg-black/60">
    <div class="flex items-center gap-3 cursor-pointer group" onclick="navigateTo('home')">
      <div class="relative w-10 h-10 bg-[#3D2B1F] rounded-full flex items-center justify-center border-2 border-yellow-400 shadow-[0_0_15px_rgba(251,191,36,0.3)] transition-transform group-hover:rotate-12">
        ${getIcon('Star')}
      </div>
      <div>
        <h1 class="text-lg font-black tracking-tighter text-orange-500 uppercase">KristoShop</h1>
        <p class="text-[9px] text-gray-500 uppercase tracking-widest flex items-center gap-1">
          ${getIcon('MapPin')} Airdrie â€¢ CA
        </p>
      </div>
    </div>
    <div class="hidden md:flex gap-10">
      ${['home','services','subs','random'].map(p=>`<button onclick="navigateTo('${p}')" class="text-[10px] font-black tracking-[0.2em] uppercase transition-all ${currentPage===p?'text-orange-500':'text-gray-400 hover:text-white'}">${p==='home'?'Station':p==='services'?'Bounties':p==='subs'?'Passes':'Stash'}</button>`).join('')}
    </div>
    <button onclick="showCart=true; renderApp()" class="relative p-2 text-orange-500">
      ${getIcon('ShoppingCart')}
      ${cart.length>0?`<span class="absolute top-0 right-0 bg-orange-600 text-[10px] font-bold px-1.5 rounded-full ring-2 ring-black">${cart.length}</span>`:''}
    </button>
  </nav>
  <main class="pt-24 pb-20 px-6 max-w-7xl mx-auto min-h-[80vh]">
    ${currentPage==='home'?renderHome():''}
    ${currentPage==='services'?renderGrid('The Bounty Board', DATA.SERVICES):''}
    ${currentPage==='subs'?renderGrid('Subscription Passes', DATA.SUBSCRIPTIONS):''}
    ${currentPage==='random'?renderGrid('The Random Stash', DATA.RANDOM):''}
    ${currentPage==='detail' && selectedProduct?renderDetail(selectedProduct):''}
  </main>
  ${showCart?renderCart():''}
  `;
}

// You can reuse the renderHome, renderGrid, renderDetail, renderCart functions from the previous HTML I gave you
// (They are identical UI-wise, no modifications)

</script>
</body>
</html>
