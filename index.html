<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KristoShop | Boutique Code Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Stripe SDK -->
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        :root {
            --brand-orange: #FF6B00;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #050505;
            color: white;
            overflow-x: hidden;
        }

        .glass {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
        }

        .selection-orange::selection {
            background-color: var(--brand-orange);
            color: black;
        }

        .animate-fade-in {
            animation: fadeIn 0.7s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body class="selection-orange">

    <!-- Navbar -->
    <nav class="fixed top-0 w-full z-50 px-6 py-4 flex justify-between items-center border-b border-white/5 glass">
        <div class="flex items-center gap-3 cursor-pointer group" onclick="navigateTo('home')">
            <div class="relative w-10 h-10 bg-[#3D2B1F] rounded-full flex items-center justify-center border-2 border-yellow-400 shadow-[0_0_15px_rgba(251,191,36,0.3)] transition-transform group-hover:rotate-12">
                <i data-lucide="star" class="text-yellow-400 fill-yellow-400 w-6 h-6"></i>
            </div>
            <div>
                <h1 class="text-lg font-black tracking-tighter text-orange-500 uppercase">KristoShop</h1>
                <p class="text-[9px] text-gray-500 uppercase tracking-widest flex items-center gap-1">
                    <i data-lucide="map-pin" class="w-2 h-2 text-red-500"></i> Airdrie • CA
                </p>
            </div>
        </div>

        <div class="hidden md:flex gap-10">
            <button onclick="navigateTo('services')" class="nav-link text-[10px] font-black tracking-[0.2em] uppercase text-gray-400 hover:text-white transition-all">Bounties</button>
            <button onclick="navigateTo('subs')" class="nav-link text-[10px] font-black tracking-[0.2em] uppercase text-gray-400 hover:text-white transition-all">Passes</button>
            <button onclick="navigateTo('random')" class="nav-link text-[10px] font-black tracking-[0.2em] uppercase text-gray-400 hover:text-white transition-all">Stash</button>
        </div>

        <button onclick="toggleCart(true)" class="relative p-2 text-orange-500">
            <i data-lucide="shopping-cart" class="w-6 h-6"></i>
            <span id="cart-count" class="hidden absolute top-0 right-0 bg-orange-600 text-[10px] font-bold px-1.5 rounded-full ring-2 ring-black">0</span>
        </button>
    </nav>

    <!-- Main Container -->
    <main id="main-content" class="pt-32 pb-20 px-6 max-w-7xl mx-auto min-h-[80vh]"></main>

    <!-- Cart Drawer -->
    <div id="cart-drawer" class="fixed inset-0 z-[100] hidden flex justify-end">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-md" onclick="toggleCart(false)"></div>
        <div class="relative w-full max-w-md bg-[#080808] border-l border-orange-500/20 h-full p-8 flex flex-col">
            <div class="flex justify-between items-center mb-10">
                <h3 class="text-2xl font-black text-orange-500 flex items-center gap-2 uppercase tracking-tighter">
                    <i data-lucide="package" class="w-6 h-6"></i> YOUR HAUL
                </h3>
                <button onclick="toggleCart(false)"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div id="cart-items" class="flex-grow overflow-y-auto space-y-4">
                <!-- Items injected here -->
            </div>
            <div class="pt-8 border-t border-white/10 mt-4">
                <div class="flex justify-between items-center mb-6">
                    <span class="text-gray-500 font-bold uppercase text-xs tracking-widest">Total</span>
                    <span id="cart-total" class="text-3xl font-black text-orange-500">$0</span>
                </div>
                <button onclick="handleStripeCheckout()" id="checkout-btn" class="w-full py-5 rounded-2xl bg-[#FF6B00] text-black font-black text-lg hover:bg-orange-400 transition-all uppercase tracking-widest">
                    PROCEED TO STRIPE
                </button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="fixed bottom-10 right-10 z-[200] hidden bg-orange-600 text-white px-6 py-4 rounded-2xl shadow-2xl animate-fade-in">
        <i data-lucide="check-circle-2" class="w-5 h-5 inline mr-2"></i> <span id="notif-text"></span>
    </div>

    <footer class="border-t border-white/5 py-12 text-center text-gray-600 text-[10px] uppercase font-bold tracking-[0.3em]">
        KristoShop • Airdrie • Alberta • CA
    </footer>

    <script>
        /**
         * ENVIRONMENT CONFIGURATION (Vercel Integration)
         * Note: SECRET_KEY is mentioned here but for security, client-side code 
         * only utilizes the PUBLISHABLE_KEY.
         */
        const ENV = {
            GEMINI_API_KEY: window.ENV?.VITE_GEMINI_API_KEY || "",
            STRIPE_PUBLISHABLE_KEY: window.ENV?.VITE_STRIPE_PUBLISHABLE_KEY || "pk_test_sample",
            STRIPE_SECRET_KEY: window.ENV?.VITE_STRIPE_SECRET_KEY || "" // Stored for internal logic ref
        };

        // Initialize Stripe
        const stripe = Stripe(ENV.STRIPE_PUBLISHABLE_KEY);

        // --- Data & State ---
        const DATA = {
            SERVICES: [
                { id: 'game', name: 'Game Development', headline: 'High-Octane Logic', price: 50, icon: 'gamepad-2', desc: 'Lua and C# engineering for Stormworks, Roblox, and Unity.', image: 'https://images.unsplash.com/photo-1542751371-adc38448a05e?auto=format&fit=crop&q=80&w=800' },
                { id: 'site', name: 'Web Development', headline: 'Liquid Glass Web', price: 30, icon: 'globe', desc: 'Fast, responsive React and Tailwind builds for modern business.', image: 'https://images.unsplash.com/photo-1517694712202-14dd9538aa97?auto=format&fit=crop&q=80&w=800' }
            ],
            SUBS: [
                { id: 'maint', name: 'Priority Support', headline: 'Zero Downtime', price: 100, icon: 'shield-check', desc: 'Ongoing maintenance and priority patching for existing systems.', image: 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&q=80&w=800' }
            ],
            STASH: [
                { id: 'rnd', name: 'Mystery Script', headline: 'Luck of the Draw', price: 10, icon: 'dice-5', desc: 'Random high-quality utility script from our private archive.', image: 'https://images.unsplash.com/photo-1550751827-4bd374c3f58b?auto=format&fit=crop&q=80&w=800' }
            ]
        };

        let cart = [];
        
        // --- Core Functions ---
        function navigateTo(view, data = null) {
            const main = document.getElementById('main-content');
            main.innerHTML = '';
            main.classList.remove('animate-fade-in');
            void main.offsetWidth; 
            main.classList.add('animate-fade-in');

            if (view === 'home') renderHome();
            else if (view === 'services') renderGrid('The Bounty Board', DATA.SERVICES);
            else if (view === 'subs') renderGrid('Subscription Passes', DATA.SUBS);
            else if (view === 'random') renderGrid('The Stash', DATA.STASH);
            else if (view === 'detail') renderDetail(data);
            
            lucide.createIcons();
            window.scrollTo(0,0);
        }

        function renderHome() {
            document.getElementById('main-content').innerHTML = `
                <div class="space-y-32">
                    <section class="py-20 text-center">
                        <h2 class="text-6xl md:text-[8rem] font-black mb-10 leading-[0.8] tracking-tighter uppercase">
                            THE <br/> <span class="text-orange-500">FAR WEST</span> <br/> OF CODE.
                        </h2>
                        <p class="text-gray-400 text-lg md:text-2xl mb-12 max-w-2xl mx-auto uppercase font-bold tracking-tight">
                            Boutique engineering in Airdrie. Specialized in Lua, Game Logic, and React.
                        </p>
                        <button onclick="navigateTo('services')" class="px-12 py-5 bg-orange-500 text-black font-black rounded-2xl text-lg hover:scale-105 transition-all uppercase">
                            EXPLORE BOUNTIES <i data-lucide="chevron-right" class="inline ml-2"></i>
                        </button>
                    </section>
                </div>`;
        }

        function renderGrid(title, items) {
            let html = `<div class="mb-16"><h2 class="text-5xl font-black text-white mb-4 uppercase tracking-tighter">${title}</h2><div class="w-20 h-1 bg-orange-500"></div></div>`;
            html += `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">`;
            items.forEach(item => {
                html += `
                <div onclick='navigateTo("detail", ${JSON.stringify(item)})' class="cursor-pointer group flex flex-col bg-[#080808] border border-white/5 rounded-[3rem] overflow-hidden hover:border-orange-500/30 transition-all">
                    <div class="h-56 overflow-hidden relative">
                        <img src="${item.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-1000">
                        <div class="absolute inset-0 bg-gradient-to-t from-[#080808] to-transparent"></div>
                        <div class="absolute bottom-4 left-6 flex items-center gap-3">
                            <div class="p-3 bg-orange-500 rounded-2xl text-black"><i data-lucide="${item.icon}" class="w-5 h-5"></i></div>
                            <h3 class="text-2xl font-black text-white uppercase">${item.name}</h3>
                        </div>
                    </div>
                    <div class="p-8 flex-grow flex flex-col">
                        <p class="text-gray-500 text-xs italic mb-8">"${item.headline}"</p>
                        <div class="mt-auto flex justify-between items-center">
                            <span class="text-3xl font-black text-orange-500">$${item.price}</span>
                            <span class="text-[10px] font-black uppercase text-gray-600 tracking-widest group-hover:text-white transition-colors">Configure →</span>
                        </div>
                    </div>
                </div>`;
            });
            html += `</div>`;
            document.getElementById('main-content').innerHTML = html;
        }

        function renderDetail(item) {
            document.getElementById('main-content').innerHTML = `
                <button onclick="navigateTo('home')" class="flex items-center gap-2 text-gray-500 hover:text-orange-500 font-black uppercase text-xs tracking-widest mb-10">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i> Return
                </button>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
                    <div class="relative rounded-[3rem] overflow-hidden border border-white/10 h-[500px]">
                        <img src="${item.image}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent"></div>
                        <div class="absolute bottom-10 left-10">
                             <h2 class="text-5xl font-black text-white uppercase">${item.name}</h2>
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <p class="text-gray-400 mb-10 leading-relaxed">${item.desc}</p>
                        <div class="mb-10 p-6 bg-white/5 rounded-3xl border border-white/10" id="ai-box">
                             <button onclick="getAiAdvice('${item.name}')" class="text-[10px] font-black uppercase text-orange-500 flex items-center gap-2">
                                <i data-lucide="wand-2" class="w-4 h-4"></i> Get Technical Consult
                             </button>
                        </div>
                        <div class="mt-auto p-10 bg-white/5 rounded-[2.5rem] border border-white/10 flex justify-between items-center">
                            <div>
                                <span class="text-[10px] text-gray-500 font-black uppercase tracking-widest">Base Bounty</span>
                                <div class="text-5xl font-black text-white mt-1">$${item.price}</div>
                            </div>
                            <button onclick='addToCart(${JSON.stringify(item)})' class="px-12 py-5 bg-orange-500 text-black font-black rounded-2xl hover:scale-105 transition-all text-sm uppercase">
                                Add to Haul
                            </button>
                        </div>
                    </div>
                </div>`;
        }

        // --- Cart Logic ---
        function toggleCart(show) {
            const drawer = document.getElementById('cart-drawer');
            drawer.classList.toggle('hidden', !show);
            if(show) updateCartUI();
        }

        function addToCart(item) {
            const cartItem = { ...item, cartId: Math.random().toString(36).substr(2, 9) };
            cart.push(cartItem);
            showNotification(`Added ${item.name} to haul`);
            updateCartUI();
        }

        function removeFromCart(cartId) {
            cart = cart.filter(i => i.cartId !== cartId);
            updateCartUI();
        }

        function updateCartUI() {
            const itemsContainer = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            const countEl = document.getElementById('cart-count');
            
            itemsContainer.innerHTML = cart.length ? '' : '<div class="text-center py-20 text-gray-600 text-xs font-bold uppercase tracking-widest">Empty</div>';
            
            let total = 0;
            cart.forEach(item => {
                total += item.price;
                itemsContainer.innerHTML += `
                    <div class="p-4 rounded-2xl border border-white/5 bg-white/5 flex gap-4 items-center animate-fade-in">
                        <div class="flex-grow">
                            <div class="font-bold text-sm text-white">${item.name}</div>
                            <div class="text-orange-500 font-mono text-xs">$${item.price}</div>
                        </div>
                        <button onclick="removeFromCart('${item.cartId}')" class="text-gray-500 hover:text-white"><i data-lucide="x" class="w-4 h-4"></i></button>
                    </div>`;
            });

            totalEl.innerText = `$${total}`;
            countEl.innerText = cart.length;
            countEl.classList.toggle('hidden', cart.length === 0);
            lucide.createIcons();
        }

        // --- AI Consult Logic ---
        async function getAiAdvice(productName) {
            const box = document.getElementById('ai-box');
            box.innerHTML = '<div class="flex items-center gap-2 text-orange-500 text-[10px] font-black uppercase"><i data-lucide="loader-2" class="w-3 h-3 animate-spin"></i> Contacting Technician...</div>';
            lucide.createIcons();

            if (!ENV.GEMINI_API_KEY) {
                box.innerHTML = '<div class="text-[10px] text-red-500 font-black uppercase">AI Key Missing</div>';
                return;
            }

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${ENV.GEMINI_API_KEY}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Briefly consult on purchasing: ${productName}. Max 2 sentences. No emojis.` }] }]
                    })
                });
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "No advice found.";
                box.innerHTML = `<div class="text-xs text-gray-400"><span class="text-orange-500 font-black block mb-2 uppercase text-[10px]">AI ADVICE</span>${text}</div>`;
            } catch (err) {
                box.innerHTML = '<div class="text-[10px] text-red-500 font-black uppercase">Technician Offline</div>';
            }
        }

        // --- Stripe Integration ---
        async function handleStripeCheckout() {
            if (cart.length === 0) return;
            
            const btn = document.getElementById('checkout-btn');
            const originalText = btn.innerText;
            btn.innerText = "OPENING SECURE PORTAL...";
            btn.disabled = true;

            const total = cart.reduce((acc, i) => acc + i.price, 0);

            /**
             * For a fully functional Stripe integration with Vercel:
             * 1. You would call a Vercel Serverless Function (/api/checkout).
             * 2. That function uses the STRIPE_SECRET_KEY to create a session.
             * 3. It returns a session ID.
             * * For this client-only preview, we use the Stripe Checkout redirect pattern.
             */
            
            try {
                // If using Stripe Payment Links (Easiest for HTML only):
                // window.location.href = `https://buy.stripe.com/your_link_id?client_reference_id=${Date.now()}`;
                
                // If using Stripe Checkout Redirect (SDK method):
                const { error } = await stripe.redirectToCheckout({
                    lineItems: cart.map(item => ({
                        // In production, these IDs come from your Stripe Dashboard Products
                        price: 'price_H5ggY9q12345', 
                        quantity: 1,
                    })),
                    mode: 'payment',
                    successUrl: window.location.origin + '?session_id={CHECKOUT_SESSION_ID}',
                    cancelUrl: window.location.origin,
                });

                if (error) {
                    // Fallback to demo link if sample price IDs fail
                    showNotification("Redirecting to Test Portal...");
                    window.location.href = `https://buy.stripe.com/test_demo?amount=${total * 100}`;
                }
            } catch (err) {
                // Fallback for demo environments
                window.location.href = `https://buy.stripe.com/test_demo?amount=${total * 100}`;
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }

        function showNotification(text) {
            const notif = document.getElementById('notification');
            document.getElementById('notif-text').innerText = text;
            notif.classList.remove('hidden');
            setTimeout(() => notif.classList.add('hidden'), 3000);
        }

        // Init
        window.onload = () => {
            navigateTo('home');
        };
    </script>
</body>
</html>
